# Objeto global `process` en Node.js

El objeto global `process` permite interactuar con el entorno de ejecución y el sistema operativo.

## Rol principal

- Proporciona información del sistema y del proceso.
- Expone APIs para gestionar ciclo de vida, recursos y configuración.
- Facilita lectura de argumentos y variables de entorno.

## Información clave

### Uso de memoria

`process.memoryUsage()` devuelve estadísticas (en bytes) útiles para monitoreo y optimización.

```js
const mem = process.memoryUsage();
console.log(mem);
/*
{
    rss: 4935680,
    heapTotal: 1826816,
    heapUsed: 650472,
    external: 49879,
    arrayBuffers: 9382
}
*/
```

### ID del proceso (PID)

```js
console.log("PID:", process.pid);
// Ej: terminar desde otra terminal: kill <PID>
```

### Argumentos de la CLI

Estructura de `process.argv`:

1. Ruta al ejecutable de Node (`process.argv[0]`)
2. Ruta al script (`process.argv[1]`)
3. En adelante, los argumentos del usuario.

Ejemplo:

```bash
node app.js Juan 25
```

```js
const [, , nombre, edad] = process.argv;
console.log(`Hola ${nombre}, edad: ${edad}`);
```

## Resumen

`process` expone memoria, PID, argumentos y entorno, ayudando a depurar, configurar y optimizar aplicaciones Node.js.

---

## Manejo de argumentos con `process.argv`

Pasos:

1. Ignorar los dos primeros índices.
2. Extraer y validar argumentos.
3. Convertir tipos según necesidad.

Ejemplo con flags simples:

```bash
node script.js --entorno=dev --debug
```

```js
const args = process.argv.slice(2);
const opts = Object.fromEntries(
  args
    .filter((a) => a.startsWith("--"))
    .map((a) => {
      const [k, v = true] = a.replace(/^--/, "").split("=");
      return [k, v];
    })
);
console.log(opts); // { entorno: 'dev', debug: 'true' }
```

---

## Variables de entorno con `dotenv`

### Instalación

```bash
npm install dotenv
```

### Archivo `.env` (no subir a control de versiones)

```
PORT=3000
NODE_ENV=development
DB_HOST=localhost
DB_USER=admin
DB_PASS=super_secret
```

### Carga de variables

Opción recomendada (ESM):

```js
import "dotenv/config";

console.log(process.env.PORT);
```

CommonJS:

```js
require("dotenv").config();
console.log(process.env.NODE_ENV);
```

### Uso pragmático

```js
const PORT = Number(process.env.PORT) || 8080;
if (!process.env.DB_PASS) {
  console.error("Falta DB_PASS");
  process.exit(1);
}
```

### Buenas prácticas

- No exponer credenciales en el repositorio.
- Usar `.env.example` como plantilla.
- Validar variables críticas al iniciar.
- Separar `.env` por entorno (`.env.development`, `.env.production`).

---

## Adaptación por entorno

Cambiar solo el archivo `.env` permite ajustar puertos, credenciales y modos sin modificar código fuente, mejorando portabilidad y seguridad.

---

Referencia rápida:

- Memoria: `process.memoryUsage()`
- PID: `process.pid`
- Salir con código: `process.exit(0 | 1)`
- Señales: `process.on('SIGINT', handler)`
- Args: `process.argv`
- Entorno: `process.env`
- Carga dotenv: `import 'dotenv/config'`
